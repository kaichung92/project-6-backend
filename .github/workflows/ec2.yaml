name: EC2 Deployment
on: [push, pull_request]
jobs:
  test:
    strategy:
      matrix:
        go-version: [1.17.x, 1.18.x]
        os: [ubuntu-latest]
    runs-on: ${{ matrix.os }}
    steps:
      - uses: harmon758/postgresql-action@v1
        with:
          postgresql version: '11'
      - uses: actions/setup-go@v3
        with:
          go-version: ${{ matrix.go-version }}
      - uses: actions/checkout@v3
      - name: Prepare configuration from Github Secrets
        run: |
          subpath="/customkeystore/test"
          sudo mkdir -p "$${{secrets.https_paths_certFileParentVar}}${subpath}"
          echo "${{ secrets.MYCONFIG }}" | sudo tee "$${{secrets.https_paths_certFileParentVar}}${subpath}/config.json"
          cat "$${{secrets.https_paths_certFileParentVar}}${subpath}/config.json"
      - name: run pre commit hook
        run: ./githooks/pre-commit
